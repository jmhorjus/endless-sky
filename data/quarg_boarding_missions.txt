# Copyright (c) 2015 by Michael Zahniser
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.

	
mission "First Quarg Boarding Action"
	boarding
	source 
		government Quarg
	on offer 
		conversation 
			`	You've been waiting for this moment for a long time. As far as you know no human, not even the craziest pirate lord, has ever disabled and boarded a Quarg ship. Even after the unfathomable amount of punishment that was unleashed on it you keep expecting the alien vessel to spring to life and destroy you or vanish in a shimmer of blue light...but it seems even the Quarg have their limits. The ship is drifting, apparently without power.`
			`	You lock your docking clamps into position and inspect the hull through your instruments, keeping one eye on long-range scanners for any sign of more Quarg. Considering the way their ships can just materialize out of hyperspace, you don't expect a lot of warning. From the outside you can identify the alien craft's armaments: fearsome twin beam weapons and powerful missile defense turrets. Of course they aren't fitted onto the standard turret-mounts you're used to seeing on human ships...so removing them without damage may be a challenge. And that's assuming no part of this alien ship explodes in your face.  It looks like the primary beams are at least 60 tons each...you have enough cargo space for those, right?`
			`	A pit forms in your stomach...maybe this was a bad idea.` 
			choice 
				`	(There's no going back now. Keep scanning...look for the best way to slice open the hull.)`
					goto hull
				`	(Maybe it would be easier to capture the ship than rip it apart. Try scanning the inside of the ship for defensive measures.`
					goto capture
				`	(Abandon this insane project. No alien technology is worth your life.)`
					# defer the mission to be tried again later and boarded ship is destroyed to prevent re-boarding.
					goto selfdestruct 

			label capture
			`	You tune your sensors to inspect the living areas of the enemy ship, starting at what you're fairly certain is their airlock. It doesn't take long for your heart to sink at what you're seeing. There are literally hundreds of tiny, independent power sources distributed over the ships internal surfaces. They appear to power some kind of intrusion countermeasures. Maybe with 1000 marines you would have a prayer of capturing this ship. Maybe.`
			choice 
				`	(Ok, keep scanning. Look for a way to open the hull.)`
					goto hull
			
			label hull
			`	You begin scanning the Quarg ship's hull, looking for the best place to cut it open. There's already significant weapon damage - disabling the ship wasn't easy. You identify a few components: engines, what you think is the shield generator, and some kind of...battery? You activate your salvage cutter and open up some access holes, but the components are locked in place with strong energy anchors and you can't figure out how to cut their power.`
			`	Suddenly your thoughts are interrupted by a flashing light on your ship's comm. It looks like the Quarg want to talk.`
			choice
				`	(Ignore the comm and focus on taking this ship apart.)`
					goto end
				`	(Lets hear what they have to say.)`
					goto listen

			label listen
			`	You see the image of a Quarg on your view screen, its elongated You have no idea of its emotions - it's mannerisms seem the same as every other Quarg you've seen. You can only assume this is the captain of the ship.`
			`	"Human," it addresses you in a measured tone, "I caution you that you are making a serious error. This one understands that it is only natural for a creature such as you to test itself in battle. We Quarg have strong ships and so you have attacked this one to prove your strength. However, for one such as you to posses Quarg tools or the Drak's gift is taboo. It can only lead to destruction. Your power has already been shown. Withdraw now and leave this system. Then peace will remain between us."`
			choice 
				`	(Ignore him. You've come too far to stop now. The very fact that the alien is talking to you means salvaging its technology must be possible.)`
					goto end
				`	(Agree and disengage your boarding clamps.)`
					goto peace

			label peace
			`	"You have made a wise choice today, Human. Leave this system and the Quarg will remain at peace with you unless you test us again."`
				goto selfdestruct

			label selfdestruct
			`	As you disengage your boarding clamps and begin to boost away you see multiple escape pods jettisoning from the Quarg ship.`
				# defer the mission to be tried again later and boarded ship is destroyed to prevent re-boarding.
				depart

			label end
			`	As the Quarg talks you run the cross-hairs of your salvage cutter over its hull, praying for some inspiration. Then it hits you. The comm signal! It's not coming from anywhere near where you'd expect the bridge to be, but when you look closer you see that the residual energy patterns in the hull subtly shift around that location. You take aim and pull the trigger. As a new hull breach opens up, you see several Quarg bodies being sucked into the vacuum of space.  The comm signal dies...and so do the energy anchors protecting the ship's components.`
			`	Mission accomplished! Your regular salvage equipment can take it from here. It's time to grab everything you can carry and get the heck out of dodge. You've heard that a Quarg can live for hundreds of years...hopefully they don't hold grudges.`
				# proceed to boarding interface and this mission will never happen again.
				decline

	on defer
		# If the player does not follow through with stealing the outfits, set reputation to exactly 1.  
		"reputation: Quarg" = 1
	on decline 
		# If the player does proceed to boarding, set reputation to -1000 and set a variable that can be used for other mission / dialog triggers even if Quarg reputation changes later.  
		"reputation: Quarg" = -1000
		set "taken quarg technology"
	# The destination doesn't matter - this mission is always deferred or declined. 
	destination Earth



# Once the player has taken quarg technology, they will be watched wherever they go.  
government "Unknown Watchers"
	swizzle 0
	color .88 .77 0
	"player reputation" 1
	"friendly hail" "encrypted signal"
	"hostile hail" "encrypted signal 2"

phrase "encrypted signal"
	word
		"[0100010110101101011010100101]"
		"[white noise]"
phrase "encrypted signal 2"
	word
		"[00000010000001100000111000011110001001]"
		"[static]"

ship "Drone (Anonymous)"
	sprite "ship/surveillance drone"
	attributes
		category "Drone"
		"cost" 15000
		"hull" 1000
		"mass" 15
		"drag" .53
		"heat dissipation" .9
		"outfit space" 60
		"weapon capacity" 0
		"engine capacity" 28
		"fuel capacity" 1000
		"jump speed" .3
		"jump drive" 1
		"hyperdrive" 1
		"automaton" 1
		weapon
			"blast radius" 3
			"shield damage" 30
			"hull damage" 15
			"hit force" 45
	outfits
		"nGVF-AA Fuel Cell"
		"Outfit Scanner"
		"X1700 Ion Thruster"
		"X1200 Ion Steering"
	engine -5 29
	engine 5 29
	explode "tiny explosion" 15
	description "This unmarked drone is equipped with outfit scanners and a hyperdrive."


# You collect a new observer every time you land.
# Whenever a new one appears the oldest one "fails" and disappears (if you haven't destroyed it already). 
mission "Quarg Observers 1"
	landing
	repeat
	invisible
	to offer 
		has "taken quarg technology"
	npc board
		government "Unknown Watchers"
		ship  "Drone (Anonymous)"
		dialog "You board one of the drones that's been following you and inspect it, but you're not able to determine its origin. It is made from generic technology and it has been broadcasting on an encrypted frequency.  You have no idea who sent it, but you suspect your aquisition of Quarg technology may have drawn attention from any number of different parties."
	to fail
		# Checking > 1 means the player will accumulate a max of 2 annoying drones at a time.  
		"Quarg Observers 1: offered" > 1
	on fail
		#dialog "MISSION DEBUG: Failed!"
		"Quarg Observers 1: offered" --
	on complete
		#dialog "MISSION DEBUG: Complete!"
		"Quarg Observers 1: offered" --
	# The destination doesn't matter, since this is invisible and probably never "completed".
	destination Earth